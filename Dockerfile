FROM haskell:8

RUN mkdir -p /owen
WORKDIR /owen
COPY ./package.yaml .
COPY ./stack.yaml .

RUN groupadd ctf 
RUN useradd -g ctf ctf 

RUN stack setup
RUN stack install hoogle
RUN hoogle generate base

COPY ./ .
RUN stack build     
RUN chown ctf:ctf ./.token.txt
# RUN chown ctf:ctf ./
RUN chmod 444 ./flag.png
RUN chmod 444 ./flag.txt

RUN mkdir ./temp/

RUN mv ./.token.txt ./temp/.token.txt
RUN chown -R ctf:ctf ./temp/

USER ctf   
CMD [ "./.stack-work/dist/x86_64-linux-tinfo6/Cabal-3.0.1.0/build/owenbot-exe/owenbot-exe"]