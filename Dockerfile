FROM haskell:8

RUN mkdir -p /app
WORKDIR /app
COPY ./package.yaml .
COPY ./stack.yaml .

RUN stack setup
RUN stack install hoogle
RUN hoogle generate base

COPY ./ .
RUN stack build

RUN chmod 444 ./src/assets 
RUN chmod 444 ./src/commands
RUN chmod 444 ./flag.png
RUN chmod 444 ./flag.txt
RUN chmod -R 444 ./
RUN chmod 777 ./.token.txt

RUN useradd -s /bin/bash ctf
USER ctf

CMD [ "stack", "run" ]